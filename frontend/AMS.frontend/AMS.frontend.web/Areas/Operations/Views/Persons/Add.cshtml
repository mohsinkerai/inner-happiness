@model PersonModel
@{
    ViewBag.ModuleTitle = "Person Management";
    ViewBag.PageTitle = "Basic Information Form";
}

@{
    await Html.RenderPartialAsync("_PersonPartial", Model).ConfigureAwait(false);
}

@section scripts{

    @Html.Partial(PartialNames.ValidationScripts)
    @Html.Partial(PartialNames.DateTimePickerScripts)

    <script type="text/javascript">
        jQuery(document).ready(function() {

            $("#menu-1").addClass("m-menu__item--open m-menu__item--expanded");

            InitializeDataTableLite("education", "Education");
            InitializeDataTableLite("akdn-training", "AKDN Trainings");
            InitializeDataTableLite("professional-training", "Professional Trainings");
            InitializeDataTableLite("language", "Language");
            InitializeDataTableLite("voluntary-community", "Voluntary Community Service");
            InitializeDataTableLite("voluntary-public", "Voluntary Public Service");
            InitializeDataTableLite("employment", "Employment");
            InitializeDataTableLite("family-relation", "Family Information");

            //$("#mainForm input").prop("disabled", true);
            //$("#mainForm select").prop("disabled", true);
            //$(".cnic").prop("disabled", false);
            
            $(".relative-fields").prop("disabled", true);

            $(".relative-cnic").blur(function () {
                var cnic = $(".relative-cnic").val();
                $.ajax({
                    type: "POST",
                    url:
                        "@Url.Action(ActionNames.VerifyCnic, ControllerNames.Persons, new { area = AreaNames.Operations })",
                    data: { "cnic": cnic },
                    contentType: "application/x-www-form-urlencoded; charset=utf-8",
                    dataType: "html",
                    error: function(xmlHttpRequest, textStatus, errorThrown) {
                        alert("Request: " +
                            xmlHttpRequest.toString() +
                            "\n\nStatus: " +
                            textStatus +
                            "\n\nError: " +
                            errorThrown);
                    },
                    success: function(result) {
                        $("#familyRelationData").html(result);
                        Initialize();
                    }
                });
                @*$.post("@Url.Action(ActionNames.VerifyCnic, ControllerNames.Persons, new { area = AreaNames.Operations })", { cnic: $(".relative-cnic").val() })
                    .done(function(data) {
                        $("#mainForm input").prop("disabled", false);
                        $("#mainForm select").prop("disabled", false);

                        $("#RelocateLocation").prop("disabled", true);
                        $("#RelocationDateTime").prop("disabled", true);

                        $("#LocalCouncil").prop("disabled", true);
                        $("#Jamatkhana").prop("disabled", true);

                        $("#HighestLevelOfStudyOther").prop("disabled", true);
                        $("#OccupationTypeOther").prop("disabled", true);
                        $("#NatureOfBusinessOther").prop("disabled", true);

                        $("#PassportNumber").focus();
                    });*@
            });

            //$(".cnic").blur(function() {
            //    $.post("Verify", { cnic: $(".cnic").val() })
            //        .done(function(data) {
            //            $("#mainForm input").prop("disabled", false);
            //            $("#mainForm select").prop("disabled", false);

            //            $("#RelocateLocation").prop("disabled", true);
            //            $("#RelocationDateTime").prop("disabled", true);

            //            $("#LocalCouncil").prop("disabled", true);
            //            $("#Jamatkhana").prop("disabled", true);

            //            $("#HighestLevelOfStudyOther").prop("disabled", true);
            //            $("#OccupationTypeOther").prop("disabled", true);
            //            $("#NatureOfBusinessOther").prop("disabled", true);

            //            $("#PassportNumber").focus();
            //        });
            //});

            $("#PlanToRelocate").change(function() {
                if (this.checked) {
                    $("#RelocateLocation").prop("disabled", false);
                    $("#RelocationDateTime").prop("disabled", false);
                } else {
                    $("#RelocateLocation").prop("disabled", true);
                    $("#RelocationDateTime").prop("disabled", true);
                }
            });

            MakeCascadingDropDown("regional-select",
                "local-select",
                "@Url.Action(ActionNames.GetLocalCouncil, ControllerNames.Persons, new {area = AreaNames.Operations})");

            MakeCascadingDropDown("local-select",
                "jamatkhana-select",
                "@Url.Action(ActionNames.GetJamatkhana, ControllerNames.Persons, new {area = AreaNames.Operations})");

            $("#Cnic").inputmask({
                "mask": "99999-9999999-9"
            });

            $("#RelativeCnic").inputmask({
                "mask": "99999-9999999-9"
            });

            $(".highest-level-select").change(function() {
                var selectedValue = $(this).val();
                if (selectedValue === "Others") {
                    $("#HighestLevelOfStudyOther").prop("disabled", false);
                }
            });

            $(".occupation-type").change(function() {
                var selectedValue = $(this).val();
                if (selectedValue === "Others") {
                    $("#OccupationTypeOther").prop("disabled", false);
                }
            });

            $(".nature-of-business").change(function() {
                var selectedValue = $(this).val();
                if (selectedValue === "Others") {
                    $("#NatureOfBusinessOther").prop("disabled", false);
                }
            });

            $("#Cnic").focus();

            $("#education").css("min-height", "0px");
            $("#akdn-training").css("min-height", "0px");
            $("#professional-training").css("min-height", "0px");
            $("#language").css("min-height", "0px");
            $("#voluntary-community").css("min-height", "0px");
            $("#voluntary-public").css("min-height", "0px");
            $("#employment").css("min-height", "0px");
            $("#family-relation").css("min-height", "0px");
        });
    </script>
}